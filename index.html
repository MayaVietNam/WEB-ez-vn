<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Nhập - Cổng Dịch Vụ Wifi MayaVietNam</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/VvSyGkBV/EZ-LOGO-08.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap');
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f0f4f8;
        }
        .glass-container {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .bg-logo-bg { pointer-events: none; position: fixed; z-index: -1; left: 0; top: 0; width: 100vw; height: 100vh; overflow: hidden; }
        .bg-logo-bg-inner { position: absolute; left: 50%; top: 50%; width: 200vw; height: 200vh; transform: translate(-50%, -50%) rotate(-10deg); background-image: url('https://i.postimg.cc/yd4v4YHG/EZ-LOGO-31.png'); background-repeat: repeat; background-size: 120px auto; opacity: 0.05; will-change: transform; }
    </style>
</head>
<body class="text-gray-800 antialiased relative">

    <div class="bg-logo-bg"><div class="bg-logo-bg-inner"></div></div>
    
    <div class="flex min-h-screen items-center justify-center p-4">
        <div class="w-full max-w-md">
            <div class="glass-container transform transition-all duration-500 hover:scale-105 rounded-2xl p-8 shadow-2xl">
                
                <div class="mb-8 text-center">
                    <img src="https://i.postimg.cc/VvSyGkBV/EZ-LOGO-08.png" alt="EZ Maya Logo" class="mb-4 h-16 w-auto mx-auto">
                    <h2 class="text-3xl font-bold text-gray-900">Chào Mừng Quay Trở Lại</h2>
                    <p class="mt-2 text-gray-600">Đăng nhập vào cổng dịch vụ của bạn</p>
                </div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-account" class="block text-sm font-semibold text-gray-700">Tài khoản (Đối tác hoặc MST)</label>
                        <input type="text" id="login-account" class="mt-1 block w-full rounded-lg border-gray-300 bg-white/70 px-4 py-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition" required>
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-semibold text-gray-700">Mật khẩu</label>
                        <input type="password" id="login-password" class="mt-1 block w-full rounded-lg border-gray-300 bg-white/70 px-4 py-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition" required>
                    </div>
                    <p id="login-error" class="text-sm text-red-600 h-4 text-center"></p>
                    <div>
                        <button type="submit" id="login-button" class="flex w-full justify-center rounded-lg bg-indigo-600 px-4 py-3 text-base font-semibold text-white shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-transform transform hover:scale-105">
                            <span id="login-spinner" class="hidden h-5 w-5 animate-spin rounded-full border-b-2 border-white"></span>
                            <span id="login-text">Đăng Nhập</span>
                        </button>
                    </div>
                </form>

                <div class="mt-6 text-center text-sm">
                    <p class="text-gray-600">
                        Doanh nghiệp mới? 
                        <a href="./Corporate/index.html" class="font-semibold text-indigo-600 hover:text-indigo-500">Đăng ký tại đây</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('login-form');
        const loginAccountInput = document.getElementById('login-account');
        const loginPasswordInput = document.getElementById('login-password');
        const loginError = document.getElementById('login-error');
        const loginButton = document.getElementById('login-button');
        const loginSpinner = document.getElementById('login-spinner');
        const loginText = document.getElementById('login-text');
        
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwqKgCKJune5u9ezFieKBaTY-P78jOiWExBBgLB7SD-0Yr5svIUn3gsGs-DVHsNvnuf/exec';
        
        const partnerAccounts = {
            'his_user': { path: './HIS/index.html' },
            'toyota_user': { path: './TOYOTA/index.html' },
            'yamaha_user': { path: './YAMAHA/index.html' }
        };

        const setLoginButtonState = (enabled) => {
            loginButton.disabled = !enabled;
            loginSpinner.classList.toggle('hidden', enabled);
            loginText.textContent = enabled ? 'Đăng Nhập' : 'Đang xử lý...';
        };

        const handleLogin = async (e) => {
            e.preventDefault();
            setLoginButtonState(false);
            loginError.textContent = '';
            
            const account = loginAccountInput.value.trim();
            const password = loginPasswordInput.value.trim();

            if (!account || !password) {
                loginError.textContent = 'Vui lòng nhập tài khoản và mật khẩu.';
                setLoginButtonState(true);
                return;
            }

            // Xử lý đăng nhập cho đối tác
            if (partnerAccounts[account.toLowerCase()] && password === 'MAYAVIETNAM') { // Mật khẩu chung cho đối tác
                loginError.textContent = 'Đăng nhập thành công, đang chuyển hướng...';
                loginError.className = 'text-sm text-green-600 h-4 text-center';
                setTimeout(() => {
                    window.location.href = partnerAccounts[account.toLowerCase()].path;
                }, 500);
                return;
            }

            // Xử lý đăng nhập cho doanh nghiệp bằng MST
            try {
                const response = await fetch(`${SCRIPT_URL}?action=login&taxCode=${encodeURIComponent(account)}&password=${encodeURIComponent(password)}`);
                if (!response.ok) throw new Error("Lỗi mạng hoặc máy chủ.");
                
                const result = await response.json();

                if (result.result === 'success' && result.isValid) {
                    loginError.textContent = 'Đăng nhập thành công, đang chuyển hướng...';
                    loginError.className = 'text-sm text-green-600 h-4 text-center';
                    // Chuyển đến trang đặt hàng của doanh nghiệp, mang theo MST
                    setTimeout(() => {
                        window.location.href = `./Corporate/order.html?taxCode=${encodeURIComponent(account)}`;
                    }, 500);
                } else {
                    loginError.textContent = result.error || 'Tài khoản hoặc mật khẩu không chính xác.';
                    setLoginButtonState(true);
                }
            } catch (error) {
                loginError.textContent = 'Lỗi kết nối. Vui lòng thử lại.';
                setLoginButtonState(true);
            }
        };

        loginForm.addEventListener('submit', handleLogin);
    });
    </script>
</body>
</html>

